type Allocation {
  dbId: Int!
  end: DateTime!
  resources: [Resource!]!
  start: DateTime!
  task: Task!
}

type Availability {
  dbId: Int!
  duration: Int!
  resource: Resource!
  weekday: Weekday!
}

input AvailabilityInput {
  duration: Int!
  weekday: Weekday!
}

enum CalculationState {
  CALCULATING
  FINISHED
  MODIFIED
}

type CalculationUpdate {
  plan: Plan
  state: CalculationState!
}

type Country {
  isocode: String!
  name: String!
  regions: [Region!]!
}

"""
Combined date and time (with time zone) in [RFC 3339][0] format.

Represents a description of an exact instant on the time-line (such as the
instant that a user account was created).

[`DateTime` scalar][1] compliant.

See also [`chrono::DateTime`][2] for details.

[0]: https://datatracker.ietf.org/doc/html/rfc3339#section-5
[1]: https://graphql-scalars.dev/docs/scalars/date-time
[2]: https://docs.rs/chrono/latest/chrono/struct.DateTime.html
"""
scalar DateTime

type Holiday {
  country: Country
  dbId: Int!
  entries(from: LocalDate!, until: LocalDate!): [HolidayEntry!]!
  externalId: String!
  name: String!
  region: Region
}

type HolidayEntry {
  date: LocalDate!
  dbId: Int!
  holiday: Holiday!
  name: String
}

type Interval {
  end: DateTime!
  start: DateTime!
}

type Issue {
  code: IssueCode!
  dbId: Int!
  description: String!
  task: Task
  type: IssueType!
}

enum IssueCode {
  DEPENDENCY_LOOP
  HIERARCHY_LOOP
  MILESTONE_MISSING
  NO_EFFORT
  NO_SLOT_FOUND
  PRED_ISSUE
  REQUIREMENT_MISSING
  RESOURCE_MISSING
  UNKNOWN
}

enum IssueType {
  GENERAL
  PLANNING_GENERAL
  PLANNING_TASK
  TASK
}

"""
Date in the proleptic Gregorian calendar (without time zone).

Represents a description of the date (as used for birthdays, for example).
It cannot represent an instant on the time-line.

[`LocalDate` scalar][1] compliant.

See also [`chrono::NaiveDate`][2] for details.

[1]: https://graphql-scalars.dev/docs/scalars/local-date
[2]: https://docs.rs/chrono/latest/chrono/naive/struct.NaiveDate.html
"""
scalar LocalDate

type Mutation {
  new: Mutation!

  """Trigger a manual recalculation now"""
  recalculateNow: Boolean!
  resourceDelete(resourceId: Int!): Boolean!
  resourceSave(resource: ResourceSaveInput!): Resource!
  taskDelete(taskId: Int!): Boolean!
  taskSave(task: TaskSaveInput!): Task!
}

type Plan {
  allocations: [Allocation!]!
}

type Query {
  countries: [Country!]!
  country(isocode: String!): Country
  currentPlan: Plan!
  getFromOpenHolidays(isocode: String!): Holiday
  helloWorld: String!
  issues: [Issue!]!
  region(isocode: String!): Region
  resources: [Resource!]!
  tasks: [Task!]!
}

type Region {
  country: Country!
  countryName: String!
  holiday: Holiday!
  isocode: String!
  name: String!
  regionName: String!
}

type Resource {
  added: DateTime!
  availability: [Availability!]!
  combinedAvailability(end: DateTime!, start: DateTime!): [Interval!]!
  dbId: Int!
  holiday: Holiday
  name: String!
  removed: DateTime
  timezone: String!
  vacation: [Vacation!]!
}

type ResourceConstraint {
  entries: [ResourceConstraintEntry!]!
  id: Int!
  optional: Boolean!
  speed: Float!
}

type ResourceConstraintEntry {
  id: Int!
  resource: Resource!
}

input ResourceConstraintEntryInput {
  resourceId: Int!
}

input ResourceConstraintInput {
  entries: [ResourceConstraintEntryInput!]!
  optional: Boolean!
  speed: Float!
}

input ResourceSaveInput {
  added: DateTime!
  addedVacations: [VacationInput!]
  availability: [AvailabilityInput!]
  dbId: Int
  holidayId: Int
  name: String!
  removed: DateTime
  removedVacations: [Int!]
  timezone: String!
}

type Subscription {
  apiVersion: String!
  calculationUpdate: CalculationUpdate!
}

type Task {
  allocations: [Allocation!]!
  children: [Task!]!
  dbId: Int!
  description: String!
  designation: TaskDesignation!
  earliestStart: DateTime
  effort: Float
  issues: [Issue!]!
  parent: Task
  predecessors: [Task!]!
  resourceConstraints: [ResourceConstraint!]!
  scheduleTarget: DateTime
  successors: [Task!]!
  title: String!
}

enum TaskDesignation {
  GROUP
  MILESTONE
  REQUIREMENT
  TASK
}

input TaskSaveInput {
  children: [Int!]
  dbId: Int
  description: String!
  designation: TaskDesignation!
  earliestStart: DateTime
  effort: Float
  parentId: Int
  predecessors: [Int!]
  resourceConstraints: [ResourceConstraintInput!]
  scheduleTarget: DateTime
  successors: [Int!]
  title: String!
}

type Vacation {
  dbId: Int!
  from: DateTime!
  until: DateTime!
}

input VacationInput {
  from: DateTime!
  until: DateTime!
}

enum Weekday {
  FRIDAY
  MONDAY
  SATURDAY
  SUNDAY
  THURSDAY
  TUESDAY
  WEDNESDAY
}